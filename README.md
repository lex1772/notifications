# Микросервис уведомления пользователей

Микросервис представляет из себя RestAPI сервер, который позволяет создавать запись уведомления в документе пользователя в MongoDB, отправлять email, а так же предоставляет листинг уведомлений из документа пользователя.

Для отправки email автоматически создается пользователь с email, который задан в переменных окружения.

Уведомления для одного пользователя ограничены в количестве 10 штук, иначе сервис предупреждает, что уведомлений больше и не добавляет новые.

### Примеры запросов

1. POST `http://localhost:8000/create` - создать новое уведомление
   
   Пример тела запроса:
   
   {
   
      "user_id": "638f394d4b7243fc0399ea67",
   
      "key": "registration",
   
    }
  
   Пример ответа:

   {
  
     "success": true,
   
    }

2. GET `http://localhost:8000/list` - создать новое уведомление

  query params:
  - user_id [string] - идентификатор пользователя
  - skip [int] - кол-во уведомлений, которые следует пропустить
  - limit [int] - кол-во уведомлений которые следует вернуть

  Пример ответа:
  
  {
  
    "success": true,
    
    "data": {
    
        "elements": 23, // всего уведомлений
        
        "new": 12, // Кол-во непрочитанных уведомлений
        
        "request": {
        
            "user_id": "638f394d4b7243fc0399ea67",
            
            "skip": 0,
            
            "limit": 10,
            
        }
        
        "list": [
        
            {
            
                "id": "some_notification_id",
                
                "timestamp": 1698138241,
                
                "is_new": false,
                
                "user_id": "638f394d4b7243fc0399ea67",
                
                "key": "new_message",
                
                "target_id": "0399ea67638f394d4b7243fc",
                
                "data": {
                
                    "some_field": "some_value"
                    
                },
            },
            
            ...
            
        ]
        
    }
    
3. POST `http://localhost:8000/read` - прочитать уведомление

   Пример ответа:

   {
  
     "success": true,
   
    }

### Что сделано?

:white_check_mark: Реализовано REST API, принимающее на вход POST и GET запросы.

:white_check_mark: База данных запускается как Docker контейнер и настроен volume для сохранения данных.

:white_check_mark: Проект запускается через Docker-compose.


### Стек технологий:

- FastAPI
- MongoDB
- Flake8
- python-dotenv
- pydantic

### Начало работы с Docker-compose
1. Заполнить .env файл в соответствии с .env_sample
2. Создать образ с помощью команды `docker-compose build`
3. Запустить контейнеры с помощью команды `docker-compose up`

### Начало работы без Docker-compose
1. Заполнить .env файл в соответствии с .env_sample
2. Запустить прложение командой `uvicorn app.server.app:app --reload` или через IDE можно запустить файл `main.py`
